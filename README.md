# DY2BIT_Server
<img width="1200" alt="image" src="https://user-images.githubusercontent.com/39155520/161865502-135df50a-6918-4fe2-aefd-0244a5e7211a.png">

트레이딩 알고리즘 한달 수동 테스트
- 2월19일 2020만원
- 2월20일 2029만원
- 2월24일 2032만원
- 2월28일 2049만원
- 3월01일 2037만원
- 3월05일 2071만원
- 3월07일 2086만원
- 3월13일 2103만원

## 서버 기획 스펙
### 0. 공통 
- 업비트, 바이낸스, 환율 api를 3~5초 주기로 가격을 받아와 김프가를 계산합니다.
- 해당 김프가를 기준으로 가격 트래킹과 사용자 예약 주문 처리를 진행합니다.
### 1. 가격 트래킹
- 매일 00시 00분에 오늘의 김프가를 생성합니다.
- 공통에서 처리한 김프가를 기준으로 오늘 날짜의 최대, 최소 코인 시세 기록을 자동 저장합니다.(최저가, 최대가 기록을 위한 작업)
### 2. 사용자 예약 주문 처리
- 사용자가 예약 주문을 요청하면 해당 요청을 저장합니다.
- 현재 김프가와 환율도 함께 조회하여 저장합니다.
- 예약 주문된 내역은 프론트에서 볼 수 있도록 리스트로 내려줍니다.
- 공통에서 처리한 김프가를 기준으로 해당 김프 가격에 도달하면 자동으로 업비트와 바이낸스에서 동시에 매매를 진행합니다.
### 3. 거래소 로직
- 이하 거래소는 업비트와 바이난스 모두 포함
- 공통에서 처리된 김프가와 현재 예약 주문에 존재하는 예약 가격을 비교합니다.
- 거래소에서 잔고를 조회하여 10프로 증거금을 고려하여 예약 주문된 수량이 주문 가능한지 체크함.
- 가능하다면 0.05비트를 시장가로 거래함(한번에 호가에 쌓인 물량을 다 긁으면 수익이 줄어들기 때문에 0.05비트씩 거래함)
- 예약 주문 된 수량에서 0.05비트를 빼고 저장함.
- 3초마다 Job이 돌기 때문에 다음 스케줄에서도 조건에 만족하면 주문 수량이 0이 될 때까지 반복함.

## 기술적 고려 사항
- 호출하는 API가 많아 비동기 처리 신경쓰기 (Coroutine)
- 3초~5초마다 DB에 접근하므로 Latancy를 줄여줘야함 (Redis)
- API의 장애를 생각해서 예외처리 잘 해주기

## TODO-LIST
### 완료
- 스프링 프로젝트 세팅하기
- Liquibase 연결해서 테이블 생성하기
- 업비트 API로 현재 가격 정보 가져오기
- 바이낸스 API로 현재 가격 정보 가져오기
- 환율정보 API로 현재 환율 정보 가져오기
- Couroutine으로 API 비동기 처리
- 받아온 정보들로 김프 가격 계산
- 조건 설정 후 김프 가격과 비교해서 조건에 따라 MIN/MAX 김프가 갱신하기
- 사용자 설정 예약 가격 정보를 바탕으로 예약 매매 조건 로직 개발
- 스케줄러 설정해서 3~5초마다 잡 돌도록 하기
- 매일 00시00분에 배치잡 돌려서 Tracker 생성하기
- 요청 받은 예약 주문 환율, 김프가와 함께 저장하기
- & 관련 Controller, Service 로직 개발

### 진행 예정
- Redis 캐시 DB 이용하도록 변경
- 업비트, 바이낸스 매수 매도 api 연결, 계좌 연동
- 매매 전 잔고 수량 확인 후 매매 가능 여부 로직 추가
- 관련 로직 테스트 코드 작성

## 기술스택
- Kotlin
- Springboot
- Mysql
- JPA (Hibernate)
- Liquibase
- Coroutine
- Redis

## DB
엔티티
- DailyPrice(시세저장)
아이디, 종목명, 최소값, 최대값, 최소값 갱신 시각, 최대값 갱신 시각, 생성일

- ReservationOrder(예약 주문)
아이디, 종목명, 예약수량, 김프 설정가, 매수or매도(업비트 기준) 여부, 생성일, 종료일(취소 포함)

## Schedular & Batch Job
- 3초마다 한번씩 업비트, 바이낸스 가격을 불러와 김프 가격을 계산하고 김프를 기준으로 min, max 업데이트, 예약 주문 매매하기 로직을 수행합니다.
- 매일 00시00분에 Tracker 하나씩 추가 (하루동안은 이 Tracker에 업데이트 하는 것)

<hr>
매수 시세 계산 로직: 종목별로 평균단가 구하기 = {(물량1 * 가격1) + (물량2 * 가격2)+...+(물량n * 가격n)}/ 물량1+물량2+..+물량n
청산가격: 평균단가 - (100/레버리지 배수 * 평균단가)
평균 김프 = {(물량1 * 김프1) + (물량2 * 김프2)+...+(물량n * 김프n)}/ 물량1+물량2+..+물량n

